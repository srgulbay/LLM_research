{% extends "layout.html" %}

{% block title %}Yönetici Paneli{% endblock %}

{% block content %}

{# ÜST BAŞLIK VE ANA EYLEM BUTONU #}
<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
    <h2>Yönetici Kontrol Paneli</h2>
    <div style="display:flex; gap:0.5rem;">
        <a href="{{ url_for('upload_json') }}" class="button" style="width: auto;">
            + Yeni Araştırma Yükle (.json)
        </a>
        <a href="{{ url_for('manage_llms') }}" class="button" style="width: auto;">
            LLM Yönetimi
        </a>
    </div>
</div>

{# ARAŞTIRMA LİSTESİ #}
<section class="content-card">
    <h3>Mevcut Araştırmalar</h3>
    {% if researches %}
        <div class="case-list" style="margin-top: 1.5rem;">
            {% for research in researches %}
                <div class="case-list-item" style="display: flex; justify-content: space-between; align-items: center; padding: 1.25rem; border: 1px solid var(--border-color); border-radius: 0.5rem; margin-bottom: 1rem;">
                    <div class="research-info">
                        <strong style="font-size: 1.1rem;">{{ research.title }}</strong>
                        <p style="margin: 0.25rem 0 0 0; color: var(--light-text-color);">
                            {{ research.cases | length }} Vaka
                            <span style="margin: 0 0.5rem;">•</span>
                            {% if research.is_active %}
                                <span style="color: var(--success-color);">Aktif</span>
                            {% else %}
                                <span style="color: var(--danger-color);">Pasif</span>
                            {% endif %}
                        </p>
                    </div>
                    <div class="research-actions">
                        <a href="{{ url_for('edit_research', research_id=research.id) }}" class="button-sm">Yönet & Düzenle</a>
                    </div>
                </div>
            {% endfor %}
        </div>
    {% else %}
        <p style="margin-top: 1.5rem;">Sistemde hiç araştırma bulunmuyor. Başlamak için yukarıdaki "Yeni Araştırma Yükle" butonunu kullanın.</p>
    {% endif %}
</section>

{# GENEL ARAÇLAR VE İSTATİSTİKLER #}
<div class="upload-container" style="margin-top: 2rem;">
    <section class="content-card">
        <h4>Genel İstatistikler</h4>
        <div class="admin-stats" style="flex-direction: column; gap: 0.5rem; margin-top: 1rem;">
            <p><strong>Toplam Katılımcı:</strong> {{ stats.user_count }}</p>
            <p><strong>Toplam Vaka Sayısı:</strong> {{ stats.case_count }}</p>
            <p><strong>Toplam Yanıt Sayısı:</strong> {{ stats.response_count }}</p>
        </div>
    </section>

    <section class="content-card">
        <h4>Veri Dışa Aktarma</h4>
        <p class="subtitle" style="margin-bottom: 1rem;">Tüm yanıtlara ait ham veriyi CSV olarak indirin.</p>
        <a href="{{ url_for('export_csv') }}" class="button">Tüm Veri Setini İndir</a>
    </section>
</div>
{% endblock %}
